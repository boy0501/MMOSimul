2023-06-30

퀘스트 기능을 만들기 위해 설계 및 코드 작성

npc간의 대화는 클라이언트에서 이루어지도록 하고, 어떤 npc와 대화를 할 지는 서버에서 판정해주기로 함.

플레이어가 어떤 npc와 대화할지 서버에서 판정해주는 findingnpc 함수를 만듬

테스트 npc 생성 및 대화하는것 확인 (정상 작동)


다음 할 일
----------
클라이언트에 lua를 추가하고, npc와의 대화를 스크립트 형식으로 짜서 테스트까지 마치기

npc와의 대화는 그냥 읽는 형식과, 예/아니오 를 선택할수있는 분기가 나눠진 대화 두가지를 만들기.

----------------------
2023-07-08
여러가지 정보를 찾아보고 주변 사람과 얘기를 해본 뒤 내린 결정

클라이언트에 lua를 추가하는건 보류하기로 한다.

내가 생각해놓은 구조를 생각해보고, 보통 게임의 클라에 lua관련 정보가 있나 봤더니, 없었다. 내가 못찾은 것일 수 있지만 퀘스트관련 스크립트는 서버에서 판단해주는게 맞는 것 같다.

그러기위해선 스크립트 내에서 잠깐 멈췄다가 사용자 입력이 들어 온 후 다시 그 코드를 실행해야하는데, 단순하게 생각해보면 사용자 입력을 서버에서 기다리게되면 스레드가 멈추게 된다. 이것을 구현하기 위해선 멀티스레드 같은 기능이나 context switch같은 기능이 없다면 구현이 불가능 할 것 같은데, 예전 imc게임즈에서 썼던 스크립트 코드에서는 분명 가능했었기 때문에 가능하다는 것을 전제로 두고 찾아보니 루아에 코루틴이라는 게 있는걸 확인했다.

yield와 resume, coroutine을 이용해서 몸비틀어서 어떻게든 구현을 성공시켜보려고 한다.

https://wariua.github.io/lua-manual/5.3/manual.html#lua_yield

대강의 함수 설명이 있다. 아직 코딩을 안해서 어떤식으로 동작될지는 모르겠지만 험난한 여정이 될 것 같다. 꼭 성공 시키자

-----------------------------------------------
-> 0708 추가.

검색을 좀 더 해보니 클라이언트에서 스크립트 내용이 있는걸 확인했다. 다시 뒤집어서 클라에서 lua 스크립트를 넣어주도록 하자.

-----------------------------------------------
다시 확인해보니 메인퀘스트와 이벤트용 퀘스트가 서로 다른 것 같다. 메인스트림 퀘스트는 클라에 정보를 넣어놓고 퀘스트 아이템과 보상이 정해져있어서 그런것같은데, 이벤트 퀘스트는 보상을 기획자들이 유동적으로 바꿀 수 있게끔, 대화 스크립트를 클라에 넣어놓지 않은 것 같다.

내가 만들려고 하는 취지는 후자쪽에 가깝기 때문에, 서버에서 온몸비틀기를 다시 해주도록 하자.